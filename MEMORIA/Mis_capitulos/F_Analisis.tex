\chapter{Análisis} \label{analisis}
\section{Análisis del problema} \label{analisis.problema}
Como ya se ha aclarado varias veces a lo largo de este documento, actualmente hay una necesidad real en el mundo agrícola; la de disponer de la información sobre productos fitosanitarios de una manera centralizada, actualizada y de fácil acceso. Hoy en día esta necesidad se ha intentado abordar de varias maneras, y por ello hay disponibles varias aplicaciones que intentan apoyar al consumidor en las tareas agrícolas que involucran productos fitosanitarios. Algunos ejemplos son los productos que ofrecen empresas como aGROSLab, Cuaderno de Campo Agronev, o Agricolum. No obstante, estas aplicaciones se enfrentan al mismo problema; la inexistencia de una base de datos estandarizada cuya información sea congruente a través de los diferentes países de la Unión Europea. Por eso mismo, estas aplicaciones tienen que implementar, desarrollar y mantener ellas mismas las bases de datos que permitan acceder a la información deseada. Nuestra solución ofrecería un sistema dotado de una base de datos estandarizada, congruente en su información y completa, de código abierto y altamente escalable, por lo tanto todas las aplicaciones mencionadas arriba podrían convertirse en potenciales clientes consumidores de nuestro sistema, sustituyendo sus bases de datos por nuestra solución, con costes de integración mínimos.

\section{Propuesta de valor e intermediarios} \label{analisis.marco}
En este apartado se van a presentar los diferentes factores que van a intermediar en el proyecto: los proveedores de los datos, los recursos de los que se dispone, la propuesta de valor, los diferentes clientes del proyecto y los costes del mismo. \par
\begin{itemize}
\item \textbf{Proveedores:} Terceros de los que el proyecto se nutre para obtener los datos a emplear en la aplicación: \par Cada fuente de datos proviene de algún portal web (nacional o internacional). En el proyecto se monta una infraestructura alrededor de dichos portales y por lo tanto la desaparición de alguno de estos sitios web significaría el cese de aprovisionamiento de los datos provenientes de dicha fuente. Actualmente, el proyecto se nutre de dos fuentes distintas: los productos autorizados recogidos del portal del \textit{Mapama} \cite{mapama} y los datos provenientes de la \textit{base de datos de pesticidas a nivel Europeo} \cite{pesticidesdb}.
\item \textbf{Recursos:} Elementos con los que el alumno ha contado para desarrollar el proyecto. 
\begin{itemize}
\item Equipo de trabajo (portátil propio)
\item Laboratorio de investigación - provisto por el director del proyecto, ubicado en el laboratorio L2.09 del edificio Ada Byron, en la Escuela de Ingeniería y Arquitectura de Zaragoza.
\item Herramientas open source - Todo el stack tecnológico, debido a un presupuesto nulo ha tenido que ser gratuito.
\item 300 horas contables de trabajo, las recomendadas para proyectos de este tipo.
\end{itemize}
\item \textbf{Propuesta de valor:} Beneficios que aporta el proyecto respecto a la situación actual:
\begin{itemize}
\item Diseño de una solución de integración que recoge datos sobre productos fitosanitarios de fuentes heterogéneas y los integra en un esquema único - que pretende solucionar algunos de los problemas actuales.
\item Desarrollo de una aplicación que muestre los resultados de manera gráfica - para demostrar los resultados tanto al tribunal como a los potenciales clientes.
\item Redacción de un documento explicativo del proceso anterior - la memoria, que servirá para que el tribunal comprenda la dedicación y el esfuerzo invertido en el proyecto y los avances y logros obtenidos.
\end{itemize}
\item \textbf{Segmentos de clientes:} Los diferentes tipos de clientes objetivos a los que está dirigida la aplicación final: \par Por una parte están los  agricultores que comercializan sus productos, las instituciones encargadas de validar y certificar la importación / exportación  de productos agrícolas o las empresas importadoras / exportadoras de productos agrícolas. Este segmento se beneficiaría diréctamente de los resultados del proyecto puesto que el proceso de comprobación de los requisitos fitosanitarios sobre los productos agrícolas / pesqueros / alimentarios se conseguiría de manera mucho más sencilla. Por otro lado también se podrían beneficiar de la infraestructura conseguida en este proyecto empresas que ya implementan sus propias aplicaciones fitosanitarias, pero carezcan de ese esquema y datos estandarizados que este proyecto propone.



\end{itemize}


\section{Requisitos - Técnica \textit{\gls{moscow}}} \label{phytoscheme.requisitos}
\par 
Por recomendación del director del proyecto, el análisis y la captura de requisitos han estado desde el principio  regidos por el método \textit{\gls{moscow}}, una técnica de priorización de requisitos usada en la gestión de proyectos, análisis de negocio y desarrollo de software con objetivo de llegar a un acuerdo común con los \textit{stakeholders} (integrantes del proyecto) sobre la importancia que se debería dar a cada requisito. Esta técnica también es conocida bajo los nombres de \textit{priorización \gls{moscow}} o \textit{análisis \gls{moscow}}.
\par
La metodología \textit{\gls{moscow}} dicta cuatro categorías mediante las que se pueden priorizar los requisitos de un sistema o proyecto: 

\begin{enumerate}
\item \textbf{Debe tener:} Son aquellos requisitos críticos para que el trabajo realizado durante un periodo de tiempo determinado (en nuestro caso desde ahora hasta junio 2017) sea considerado un éxito (\textit{TFG} aprobado). Si uno de estos requisitos no se incluye, el proyecto debera ser considerado un fallo (no se puede presentar el \textit{TFG}). \textit{Debe tener} en \textit{\gls{moscow}} se refiere a \textit{MUST}, que puede ser considerado un acrónimo de \textit{Minimum Usable SubseT}. En ese sentido se puede entender como la unión de los requisitos del producto mínimo viable con los requisitos legales (p.ej. documentación en forma de memoria de \textit{TFG}, cumplimiento \textit{LOPD}, etc.) y de seguridad (en el sentido de robustez y calidad de la solución) obligatorios o acordados. Los requisitos del proyecto acordados para esta categoría han sido los siguientes: 
\begin{itemize}
\item Recolectar datos oficiales tanto de productos fitosanitarios autorizados de España como de las sustancias activas a nivel europeo. 
\item Almacenar la última versión de los datos en formato original y además mantener todas las versiones descargadas. 
\item Monitorizar y almacenar los procesos de recolección de los datos de entrada así como las rutas de su procesado.
\item Ofrecer la infraestructura y las herramientas de configuración necesarias para una expansión futura del proyecto. 
\item Implementar un modelo de aplicación consistente, ejemplificando el ciclo de vida típico de los datos desde su recogida hasta su presentación visual. 
\item Una memoria extensa y detallada. 
\end{itemize}

\item \textbf{Debería tener:} Son aquellos que son importantes pero no necesarios para ser realizados durante el periodo de tiempo determinado. Pueden posponerse para ser realizados en el siguiente periodo. Son vitales pero no obligatorios, si no se implementan la solución es viable pero es doloroso no hacerlo. En el caso de nuestro proyecto, dentro de esta categoría se han identificado los siguientes requisitos: 
\begin{itemize}
\item Mecanismo de control de esfuerzos.
\item Mecanismo de control de versiones.
\item Módulo de trazabilidad de los datos desde las fuentes originales hasta su visualización. 
\item Mecanismo de detección de errores e inconsistencias en los datos provenientes de diferentes fuentes. 
\end{itemize}


\item \textbf{Podría tener:} Son aquellos que comparados con los anteriores son los menos deseados o tienen menor impacto. Hay que tenerlos controlados ya que sólo se podrán entregar si se dan las mejores condiciones (por ejemplo, el proyecto va más rápido de los esperado). Si hay algún riesgo en la entrega del proyecto estos requisitos serían los primeros en ser descartados. A continuación se pueden ver los requisitos del proyecto que se han ubicados dentro de esta categoría:

\begin{itemize}
\item Genericidad en cuanto al soporte de integración de los datos de diferentes fuentes basado en un fichero de claves y valores. 
\item Soporte para la búsqueda de registros (datos) desde la interfaz web. 
\item Desarrollo dirigido por un paradigma de inversión de independencias para conseguir un control centralizado.
\end{itemize}

\item \textbf{No tendrá:} Son aquellos que no van a ser entregados durante el periodo considerado. Se mantienen en esta lista de alcance para clarificar el alcance de la solución. Esto evita que informalmente sean introducidos más tarde. El objetivo de esta categoría es ayudar a mantener el foco en una solución estricta. 


\begin{itemize}
\item Rediseño y desarrollo en el lado del \textit{Front-End}.
\item Desarrollo de tests adicionales en el proyecto de \textit{JHipster}
\item Integración de más de dos fuentes de datos heterogéneas. 
\end{itemize}


\end{enumerate}



\section{Análisis de riesgos}  \label{analisis.riesgos}
En la fase inicial del proyecto se abordó el proceso de gestión de riesgos, para determinar los diferentes factores que podrían afectar a un proyecto de esta envergadura. Dicho proceso consta de varios pasos que en conjunto permiten tener una visión clara de aquello que puede entorpecer, frenar o incluso imposibilitar la finalización del proyecto. A continuación se listan dichos pasos y se presentan las conclusiones principales extraídas de cada una de ellas, dejando para los anexos la versión completa: 
\begin{enumerate}
\item En primer lugar, \textbf{la identificación de riesgos} permite determinar la lista de riesgos capaces de romper la planificación del proyecto. Durante esta fase se estudió qué factores podrían influenciar, en mayor o menor medida el flujo de trabajo normal del proyecto. Se agruparon en diferentes categorías para delimitar las zonas a las que afectaría cada riesgo. Así pues, aparecen 31 riesgos divididos en 4 clases:
\begin{enumerate}
\item 4 riesgos globales (referentes a todo el proyecto)
\item 6 riesgos tecnológicos (referentes a los aspectos más técnicos y tecnológicos del proyecto)
\item 7 riesgos de alcance (referentes al tamaño y alcance de la solución)
\item 14 riesgos de entorno de desarrollo (referentes tanto a la gestión como a las diferentes partes del entorno del desarrollador)
\end{enumerate}
\item El \textbf{análisis del riesgo} ofrece una medición de la probabilidad y el impacto de cada riesgo. Maneja tres valores que determinan la gravedad de un riesgo: la probabilidad con la que se puede dar un riesgo, el impacto que tendría en el resultado final un riesgo y la aceptación del riesgo, una medida delimitadora que define aquellos riesgos que son considerados aceptables y aquellos ante los que se deben tomar medidas. En esta fase se detectaron un total de 6 riesgos reseñables, que se presentan en el siguiente punto.
\item La \textbf{priorización de riesgos}, fase donde se puede ver la lista de todos los riesgos anteriores ordenados por su gravedad. A continuación se mencionan aquellos que han tenido un factor de gravedad superior a 4, límite del criterio de aceptación. Todos los riesgos que aparecen aquí han obtenido una puntuación de 6/6: 
\begin{enumerate}
\item RG\_1. Riesgo global “Plazos”. 
\item RT\_2. Riesgo de tecnologías “Software no probado”.  
\item RT\_6. Riesgo de tecnologías “Inalcanzable”. 
\item RA\_1. Riesgo de alcance “Tamaño estimado”. 
\item RA\_6. Riesgo de alcance “Número de cambios”.  
\item RE\_9. Riesgo de entorno de desarrollo “Formación”. 
\end{enumerate}
\item Finalmente, la \textbf{planificación de la gestión de riesgos}, fase relativa al plan para tratar cada riesgo significativo. En este apartado la estrategia a seguir fue recoger los seis riesgos anteriores y proponer para cada uno una solución mitigadora. Los resultados de esta fase se pueden observar en el apartado \textit{Análisis de riesgos} de los \textit{Anexos}.
\end{enumerate}

\section{Análisis del contexto tecnológico}  \label{analisis.contexto}
Dado que se trata de un escenario caracterizado por la heterogeneidad en contenidos y formatos de los datos, la necesidad de su procesamiento y de una escalabilidad futura, el proyecto está situado en un círculo de tecnologías Big Data, que presenta los siguientes retos:
\begin{itemize}
\item \textbf{Datos.} La información sobre los productos fitosanitarios no está habitualmente disponible en un formato estructurado. Es decir, la solución debe poder trabajar con datos en formatos no estructurados y ser capaz de procesarlos, idealmente convirtiéndolos a un formato relacional.
\item \textbf{Esquema.} No existe un esquema de referencia compartido para integrar la información de productos fitosanitarios de diferentes países, pudiendo darse el caso de la existencia de varios esquemas distintos en función del caso de uso. Es decir, la solución debe poder reconfigurar el esquema de integración con facilidad.
\item \textbf{Procesado.} Derivado del reto anterior, los datos no se pueden procesar y almacenar directamente en el esquema de integración sino que  deben guardarse en el formato original y ser procesados bajo demanda teniendo en cuenta las características específicas de cada fuente.
\item \textbf{Almacenamiento.} No se dispone de un presupuesto para invertir en un gran sistema de almacenamiento que permita almacenar los datos en formato original. Por ello, toda solución deberá ser de código abierto y poder ejecutarse sobre hardware de bajo coste.
Presentación de los datos. Es necesario desarrollar una interfaz visual para presentar los datos una vez integrados en un modelo único. 
\item  \textbf{Agilidad.} La solución debe poder evolucionar con facilidad. Cualquier desarrollador que utilice la solución debe poder reconfigurar rápidamente el esquema común y los servicios que exponen dicho esquema para su uso.
\item \textbf{Plazos.} Las limitaciones temporales y la priorización de tareas son influyentes en la elección del stack tecnológico, aunque en menor medida que los puntos anteriores. 
\end{itemize}

Habiendo mencionado los factores anteriores, a continuación se presentan las tecnologías a las que se va a hacer referencia en el siguiente apartado con el objetivo de familiarizar al lector con las herramientas utilizadas:
\begin{itemize}
\item \textbf{\textit{Hadoop}.} \cite{hadoop} La librería software Apache Hadoop es un framework que permite el procesamiento distribuido de múltiples conjuntos de datos a través de clusters de ordenadores mediante modelos de programación sencillos. Está diseñado para escalar desde servidores únicos hasta miles de máquinas, donde cada una ofrece computación y almacenamiento local. Más que depender del hardware para prestar una alta disponibilidad, la librería en sí está diseñada para detectar y gestionar fallos en la capa de aplicación y así permitir una alta disponibilidad a pesar de que los equipos individuales fallen. 
\item \textbf{\textit{Hive}.} \cite{hive}  El software de data warehouse Apache Hive facilita la lectura, escritura y gestión de grandes conjuntos de datos residentes en almacenes distribuidos de datos mediante SQL. La estructura de datos puede ser proyectada sobre los datos que ya existen en almacenamiento. Apache Hive provee una herramienta de línea de comandos y un driver JDBC para que los usuarios se puedan conectar a Hive. 
\item \textbf{\textit{Sqoop}.} \cite{sqoop} Apache Sqoop es una herramienta diseñada para transferir bloques de datos entre Apache Hadoop y almacenes de datos estructurados como las bases de datos relacionales.
\item \textbf{\textit{JHipster}.} \cite{jhipster} JHipster es una plataforma de desarrollo para generar, desarrollar y lanzar aplicaciones con tecnología Spring Boot, AngularJS y Spring microservices. 
\item \textbf{\textit{Spring Framework}.} \cite{springframework} El framework Spring provee un modelo de programación y configuración sencillo para aplicaciones Java. Un punto clave de Spring es el soporte infraestructural a nivel de aplicación. 
\item \textbf{\textit{Spring Boot}.} \cite{springboot} Spring Boot es un framework ligero que tiene la intención de simplificar el proceso de configuración de una aplicación hecha con Spring. 
\item \textbf{\textit{AngularJS}.} \cite{angularjs} AngularJS es un framework de JavaScript de código abierto, mantenido por Google, que se utiliza para crear y mantener aplicaciones web de una sola página. Su objetivo es aumentar las aplicaciones basadas en navegador con capacidad de Modelo Vista Controlador (MVC), en un esfuerzo para hacer que el desarrollo y las pruebas sean más fáciles.
\item \textbf{\textit{Talend}.} \cite{talend} Talend es un software open-source de integración, procesado y transformación de datos. Permite trabajar con paradigmas Big Data y ofrece una interfaz gráfica para diseñar y programar cómodamente procesos ETL. 
\end{itemize}

\section{Elección del Stack Tecnológico}  \label{analisis.stack}
Debido a los factores mencionados en el apartado anterior, el stack tecnológico se vio restringido a las herramientas mencionadas anteriormente; tal como se ha dicho, la solución necesitaba almacenar la información en crudo hasta el momento de su procesamiento y es por ello que una aproximación relacional habría sido inviable. Por lo tanto, viendo las diferentes opciones noSQL disponibles (MongoDB, Cassandra, DynamoDB, HBase, etc) y por recomendación del director del proyecto, la elección más clara fue elegir Hadoop como sistema de almacenamiento. Hadoop es una gran herramienta para el escalado de aplicaciones y lo utilizan grandes empresas para Big Data. Se adapta perfectamente a las necesidades de este proyecto y el software es gratuito. Además, hay una gran comunidad de personas capaces de ayudar con cualquier proyecto y la documentación disponible es lo suficientemente extensa como para salir de cualquier situación problemática. \par
No obstante, Hadoop por sí mismo no era capaz de solucionar todos los problemas del proyecto; Hadoop es capaz de almacenar los datos y, si bien es cierto que las operaciones de mapreduce permiten transformar dichos datos, dada la necesidad del desarrollo ágil del proyecto, lo mejor fue disponer de algún mecanismo más sencillo para el procesado de los mismos. Por ello, se decidió emplear Hive como herramienta de traducción de los datos almacenados en Hadoop, tanto en crudo como procesados, a una estructura relacional, sobre la que se podían hacer preguntas SQL. \par
El otro reto planteado fue la presentación de los datos integrados mediante una interfaz web, lo que vendría siendo el lado del cliente de la solución. Indudablemente hay casi infinidad de posibilidades para el desarrollo de esta parte. No obstante, realmente la parte de visualización no fue una parte crítica del proyecto, ni el objetivo del mismo. Es por ello que se adoptó una postura de desarrollo rápido del lado del cliente. JHipster (generador de aplicaciones sobre Spring) resultó la herramienta indicada, puesto que facilmente, en unos cuantos pasos era capaz de generar una aplicación sobre un esquema de base de datos (en este caso MySQL) y con una interfaz gráfica cuidada que satisfacía las necesidades del proyecto. No obstante, para poder conectar la base de datos de Hadoop con la base de datos MySQL necesaria para JHipster, el paso intermedio fue conectar Hadoop con Hive y realizar operaciones ETL de Hive a JHipster mediante Sqoop, una herramienta de transformación y carga de datos entre distintas bases de datos.\par
Teniendo en cuenta que los anteriores puntos constituyen el core tecnológico del proyecto, conforme se avanzaba se veía que no eran suficientes para conseguir los resultados deseados. Se tuvieron que emplear otras herramientas adicionales para diferentes tareas como el procesado de los datos previo a su exposición en Hive pero posterior a su almacenamiento en Hadoop, o la traducción de los datos y estructuras de Hive a la base de datos que emplea JHipster. Las elegidas fueron Talend Big Data (herramienta de procesado de ficheros capaz de conectarse a Hadoop,  extraer la información contenida en sus nodos, procesarla y volver a guardarla con los cambios efectuados, tal como se le indique) y Sqoop (herramienta diseñada para transferir bloques de datos entre Apache Hadoop o Hive y almacenes de datos estructurados como las bases de datos relacionales). 

\section{Captura de requisitos final}  \label{analisis.requisitos}
Una vez realizado un análisis detallado tanto del problema como del marco conceptual y los riesgos en las fases previas al arranque del proyecto, lo  siguiente que se determinaron fueron los requisitos del sistema. Gracias al análisis previo realizado mediante la técnica \textit{\gls{moscow}} plasmado en la sección \ref{phytoscheme.requisitos} y a las conclusiones obtenidas de los apartados anteriores, la tarea de captura de requisitos \textit{funcionales} tanto del sistema como del proyecto resultó en una sencilla selección y categorización de los mismos. Además, como se puede observar, algunos de los requisitos priorizados en las categorias inferiores de \textit{\gls{moscow}} en la sección \ref{phytoscheme.requisitos} han sido descartados. Los requisitos no funcionales surgieron tanto de recomendaciones del director del proyecto como del anális previo. A continuación se recogen en tablas tanto los requisitos funcionales como los no funcionales, divididos en sistema y proyecto, siendo los de sistema los referentes al propio producto tecnológico en sí, y los de proyecto los referentes a la gestión del mismo: \par
\begin{table}[!h]
\centering
\bgroup
\def\arraystretch{1.3}
\begin{tabular}{l p{13cm}}
\toprule
\textbf{Nombre} & \textbf{Descripción} \\
 \midrule
RFS\_1 & 
El sistema deberá recolectar los datos oficiales tanto de productos fitosanitarios autorizados de España como de las sustancias activas a nivel europeo.
 \\
RFS\_2 & 
El sistema deberá almacenar la última versión de los datos recolectados en el RFS\_1 en su formato original y además mantener todas las versiones descargadas de las mismas. 
 \\
RFS\_3 & 
El sistema deberá monitorizar y almacenar los procesos de recolección de los datos de entrada, así como las rutas de su procesado. 
 \\
RFS\_4 & 
El sistema deberá ofrecer la infraestructura y herramientas de configuración necesarias para que futuros desarrolladores puedan integrar otras fuentes de datos de manera rápida y eficiente. 
 \\
RFS\_5 & 
El sistema deberá implementar un modelo de aplicación consistente, ejemplificando un ciclo de vida típico de los datos, desde su recogida, su procesamiento, su posterior integración en un modelo más completo y su presentación en un \textit{Front-End} de ejemplo.
 \\
RFS\_6 & 
El sistema deberá implementar un mecanismo de detección de errores e inconsistencias en los datos provenientes de fuentes heterogéneas.
 \\
\bottomrule
\end{tabular}
\egroup
\caption{Requisitos Funcionales del Sistema}
\label{tab:req_func_sist}
\end{table}


\begin{table}[!h]
\centering
\bgroup
\def\arraystretch{1.3}
\begin{tabular}{l p{13cm}}
\toprule
\textbf{Nombre} & \textbf{Descripción} \\
 \midrule
RNFS\_1 & 
Los información de los productos fitosanitarios deberá ser recogida de portales como \textit{Mapama} \cite{mapama} y los datos sobre los pesticidas de la \textit{Base de datos europea} \cite{pesticides_eu}.
 \\
RNFS\_2 & 
Se hará uso de algún tipo de \textit{Crawler web} \cite{wikicrawler} para la descarga periódica de los datos sobre productos fitosanitarios y pesticidas.
 \\
RNFS\_3 & 
Como sistema de almacenamiento de los datos recogidos sobre productos fitosanitarios autorizados y sustancias activas se usará \textit{Hadoop}.
 \\
RNFS\_4 & 
Para monitorizar, almacenar y mostrar los procesos de recolección de los datos de entrada se usará \textit{Talend Big Data}. 
 \\
RNFS\_5 & 
Para conseguir unos desarrollos posteriores más ágiles se hará uso de la herramienta \textit{Hive}, que permite una aproximación relacional directamente sobre \textit{Hadoop}.
 \\
RNFS\_6 & 
La presentación de los datos en su formato final se hará mediante una aplicación con \textit{GUI}, desarrollada mediante la herramienta \textit{JHipster}.
 \\
\bottomrule
\end{tabular}
\egroup
\caption{Requisitos No Funcionales del Sistema}
\label{tab:req_no_func_sist}
\end{table}
\begin{table}[!h]
\centering
\bgroup
\def\arraystretch{1.3}
\begin{tabular}{l p{13cm}}
\toprule
\textbf{Nombre} & \textbf{Descripción} \\
 \midrule
RFP\_1 & 
El proyecto deberá incluir una memoria en la que se documentan todos los pasos y procesos involucrados en su construcción.
 \\
RFP\_2 & 
Se deberá mantener constancia del esfuerzo dedicado durante el proyecto.
 \\
RFP\_3 &
El proyecto deberá mantener un control de versiones actualizado en todo momento. 
 \\
\bottomrule
\end{tabular}
\egroup
\caption{Requisitos Funcionales del Proyecto}
\label{tab:req_func_proy}
\end{table}












 


















